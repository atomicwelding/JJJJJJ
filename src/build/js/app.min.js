var game={data:{score:0},onload:function(){me.video.init(600,400,{parent:"screen",scale:"auto",scaleMethod:"stretch"})?(me.audio.init("mp3,ogg"),me.loader.preload(game.resources,this.loaded.bind(this))):alert("Your browser does not support HTML5 canvas.")},loaded:function(){me.state.set(me.state.PLAY,new game.PlayScreen),me.pool.register("mainPlayer",game.PlayerEntity),me.pool.register("firstEnemy",game.EnemyEntity),me.pool.register("secondEnemy",game.EnemyEntity),me.pool.register("thirdEnemy",game.EnemyEntity),me.input.bindKey(me.input.KEY.LEFT,"left"),me.input.bindKey(me.input.KEY.RIGHT,"right"),me.input.bindKey(me.input.KEY.UP,"up",!0),me.state.change(me.state.PLAY)},resources:[{name:"covered",type:"image",src:"data/img/sprite/covered.png"},{name:"elephant",type:"image",src:"data/img/sprite/elephant.png"},{name:"ending",type:"image",src:"data/img/sprite/ending.png"},{name:"ennemy_sprite_scaled",type:"image",src:"data/img/sprite/ennemy_sprite_scaled.png"},{name:"ennemy_sprite",type:"image",src:"data/img/sprite/ennemy_sprite.png"},{name:"entcolours",type:"image",src:"data/img/sprite/entcolours.png"},{name:"flipgamecomplete",type:"image",src:"data/img/sprite/flipgamecomplete.png"},{name:"fliplevelcomplete",type:"image",src:"data/img/sprite/fliplevelcomplete.png"},{name:"flipsprites",type:"image",src:"data/img/sprite/flipsprites.png"},{name:"font",type:"image",src:"data/img/sprite/font.png"},{name:"fontmask",type:"image",src:"data/img/sprite/fontmask.png"},{name:"gamecomplete",type:"image",src:"data/img/sprite/gamecomplete.png"},{name:"levelcomplete",type:"image",src:"data/img/sprite/levelcomplete.png"},{name:"minimap",type:"image",src:"data/img/sprite/minimap.png"},{name:"site",type:"image",src:"data/img/sprite/site.png"},{name:"site2",type:"image",src:"data/img/sprite/site2.png"},{name:"site3",type:"image",src:"data/img/sprite/site3.png"},{name:"site4",type:"image",src:"data/img/sprite/site4.png"},{name:"sprite_scaled",type:"image",src:"data/img/sprite/sprite_scaled.png"},{name:"teleporter",type:"image",src:"data/img/sprite/teleporter.png"},{name:"tiles",type:"image",src:"data/img/sprite/tiles.png"},{name:"tiles2",type:"image",src:"data/img/sprite/tiles2.png"},{name:"tiles3",type:"image",src:"data/img/sprite/tiles3.png"},{name:"area_upscaled",type:"tmx",src:"data/map/area_upscaled.tmx"},{name:"area",type:"tmx",src:"data/map/area.tmx"},{name:"level1",type:"tmx",src:"data/map/level1.tmx"},{name:"level2",type:"tmx",src:"data/map/level2.tmx"},{name:"level3",type:"tmx",src:"data/map/level3.tmx"},{name:"level4",type:"tmx",src:"data/map/level4.tmx"},{name:"sprites",type:"tsx",src:"data/map/sprites.tsx"},{name:"tiles1",type:"tsx",src:"data/map/tiles1.tsx"},{name:"tiles2",type:"tsx",src:"data/map/tiles2.tsx"},{name:"tiles3",type:"tsx",src:"data/map/tiles3.tsx"}]};game.PlayerEntity=me.Entity.extend({init:function(e,t,i){me.Entity.prototype.init.apply(this,[e,t,i]),this.body.setMaxVelocity(2,2),this.body.setFriction(.4,0),me.game.viewport.follow(this.pos,me.game.viewport.AXIS.BOTH,.4),this.alwaysUpdate=!0,this.renderable.addAnimation("walk",[0,1,2]),this.renderable.addAnimation("stand",[0]),this.renderable.setCurrentAnimation("stand"),this.data={inverted:!1,spawnx:this.pos.x,spawny:this.pos.y}},update:function(e){return me.input.isKeyPressed("left")?(this.renderable.flipX(!0),this.body.force.x=-this.body.maxVel.x,this.renderable.isCurrentAnimation("walk")||this.renderable.setCurrentAnimation("walk")):me.input.isKeyPressed("right")?(this.renderable.flipX(!1),this.body.force.x=this.body.maxVel.x,this.renderable.isCurrentAnimation("walk")||this.renderable.setCurrentAnimation("walk")):(this.body.force.x=0,this.renderable.setCurrentAnimation("stand")),me.input.isKeyPressed("up")&&(0==this.data.inverted?(this.renderable.flipY(!0),this.body.force.y=-this.body.maxVel.y,this.data.inverted=!0):(this.renderable.flipY(!1),this.body.force.y=this.body.maxVel.y,this.data.inverted=!1)),this.body.update(e),me.collision.check(this),me.Entity.prototype.update.apply(this,[e])||0!==this.body.vel.x||0!==this.body.vel.y},onCollision:function(e,t){return"Spike"!=t.type&&"Enemy"!=t.type||(this.pos.x=this.data.spawnx,this.pos.y=this.data.spawny,this.data.inverted=!1,this.renderable.flipY(!1),this.body.force.y=this.body.maxVel.y),!0}}),game.EnemyEntity=me.Entity.extend({init:function(e,t,i){me.Entity.prototype.init.apply(this,[e,t,i]),this.body.setMaxVelocity(0,2),this.body.setFriction(0,0),this.alwaysUpdate=!0,this.renderable.addAnimation("move",[0,1,2]),this.renderable.setCurrentAnimation("move");for(var a=0;0==a;)a=Math.floor(Math.random()*this.body.maxVel.y),a*=1==Math.floor(2*Math.random())?1:-1;this.body.force.y=a},update:function(e){return this.body.update(e),me.collision.check(this),me.Entity.prototype.update.apply(this,[e])||0!==this.body.vel.x||0!==this.body.vel.y},onCollision:function(e,t){return"EnemyPath"==t.type&&(this.body.force.y=-this.body.force.y),!0}}),game.HUD=game.HUD||{},game.HUD.Container=me.Container.extend({init:function(){me.Container.prototype.init.apply(this),this.isPersistent=!0,this.floating=!0,this.name="HUD",this.addChild(new game.HUD.ScoreItem(5,5))}}),game.HUD.ScoreItem=me.Renderable.extend({init:function(e,t){me.Renderable.prototype.init.apply(this,[e,t,10,10]),this.score=-1},update:function(){return this.score!==game.data.score&&(this.score=game.data.score,!0)},draw:function(e){}}),game.PlayScreen=me.Stage.extend({onResetEvent:function(){me.levelDirector.loadLevel("level4"),game.data.score=0,this.HUD=new game.HUD.Container,me.game.world.addChild(this.HUD)},onDestroyEvent:function(){me.game.world.removeChild(this.HUD)}}),game.TitleScreen=me.Stage.extend({onResetEvent:function(){},onDestroyEvent:function(){}});